<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>       
</head>

<body>  
<div>
        <a href="./result.html">結帳</a>
        <table border="1">
                <thead>
                <tr>
                        <th>id</th>
                        <th>title</th>
                        <th>companyName</th>
                        <th>unitPrice</th>
                        <th>author</th>
                        <th>img</th>
                        <th>add</th>
                </tr>
                </thead>
                <tbody></tbody>
        </table>

</div>
        
        
</body>

<script>
       const tbody = document.querySelector('tbody');
       const url = 'http://10.2.12.88:8080/javascript-shoppingcart-book/book/readAll'
        fetch(url) 
        .then(resp => resp.json())
        .then(books =>{
           bookList=books
           for (let book of books){
                tbody.innerHTML +=`
                <tr>
                        <td>${book.id}</td>
                        <td>${book.title}</td>
                        <td>${book.companyName}</td>
                        <td>${book.unitPrice}</td>
                        <td>${book.author}</td>
                        <td>
                                <img src="data:image/*;base64, ${book.img}" style="width: 50px;">
                        </td>
                        <td>
                                <button onclick='add(${book.id})'>Add</button>
                        </td>
                </tr>
                `;
           }     
        });

  function add(id){
        const book = bookList.find(b =>b.id===id );
        book.img = null;

        let shoppingcart = localStorage.getItem('shoppingcart');
        shoppingcart= JSON.parse(shoppingcart) ?? [];
        shoppingcart.push(book);
        localStorage.setItem('shoppingcart',JSON.stringify(shoppingcart));

      }   
</script>
</html>