<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>疫苗施打意願登記</title>
</head>

<body>
    <!-- 身分證字號輸入框 -->
    <label for="idNumber">身分證字號：</label>
    <input type="text" id="idNumber" placeholder="請輸入身分證字號" required>
    <br>
    <!-- 用來動態添加其他疫苗廠牌選擇框的容器 -->
    <div id="vaccine-brands-container">疫苗施打廠牌：</div>

    <script>
        // 定義疫苗廠牌對應名稱的物件
        const brands = {
            0: 'AZ',
            1: '莫德納',
            2: 'BNT',
            3: '高端'
        };

        // 當輸入框失去焦點時，檢查身分證格式
        document.getElementById('idNumber').addEventListener('blur', () => {
            const identityId = document.getElementById('idNumber').value;
            if (!identityId.match(/^[a-z](1|2)\d{8}$/i)) {
                alert('身分證格式錯誤');
            }
        });

        // 處理疫苗廠牌選擇框的函數
        function handleSelect(select, chosedBrands, id) {
            // 如果沒有傳入選擇框，則查詢第一個選擇框並複製疫苗廠牌物件
            if (!select) {
                select = document.querySelector(`#sel${id}`);
                chosedBrands = { ...brands };
            }

            // 移除後續的選擇框
            document.querySelector(`#sel${id + 1}`)?.remove();

            // 監聽選擇框的變化
            select.addEventListener('change', (e) => {
                const value = select.value;
                // 從疫苗廠牌物件中刪除已選擇的項目
                delete chosedBrands[value];

                // 如果還有剩餘的疫苗廠牌，則創建下一個選擇框
                if (Object.keys(chosedBrands).length > 0) {
                    const nextSelect = genSelect(chosedBrands, id + 1);
                    handleSelect(nextSelect, { ...chosedBrands }, id + 1);
                }
            });
        }

        // 生成疫苗廠牌選擇框的函數
        function genSelect(chosedBrands, id) {
            const select = document.createElement('select');
            select.className = 'vaccine-brand';
            select.name = 'vaccineBrand';
            select.id = `sel${id}`;

            // 創建一個帶有 disabled 和 selected 屬性的空白選項
            const option = document.createElement('option');
            option.textContent = '空白';
            option.setAttribute('disabled', 'disabled');
            option.setAttribute('selected', 'selected');
            select.appendChild(option);

            // 將每個疫苗廠牌添加到選擇框中
            for (let brand in chosedBrands) {
                const option = document.createElement('option');
                option.value = brand;
                option.textContent = chosedBrands[brand];
                select.appendChild(option);
            }

            // 將選擇框添加到容器元素中
            document.getElementById('vaccine-brands-container').appendChild(select);

            return select;
        }

        // 生成第一個疫苗廠牌選擇框並處理其事件
        const firstSelect = genSelect(brands, 0);
        handleSelect(firstSelect, { ...brands }, 0);
    </script>

</body>

</html>